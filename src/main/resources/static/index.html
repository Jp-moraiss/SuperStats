<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>SuperStats - Fãs</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; }
        .section { margin-bottom: 30px; }
        table { margin-top: 10px; }
    </style>
</head>
<body>
<div class="container">
    <h1 class="mb-4">SuperStats - Gestão de Fãs</h1>

    <!-- LISTAGEM -->
    <div class="section">
        <h3>Todos os Fãs</h3>
        <button class="btn btn-primary mb-2" onclick="getAll()">Atualizar Lista</button>
        <table class="table table-striped" id="faTable">
            <thead>
            <tr>
                <th>Email</th>
                <th>Nome</th>
                <th>Gênero</th>
                <th>Idade</th>
                <th>Universo Favorito</th>
                <th>Tempo Geek</th>
                <th>Ocupação</th>
            </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- BUSCA -->
    <div class="section">
        <h3>Buscar Fã por Email</h3>
        <div class="input-group mb-2">
            <input type="text" id="emailGet" class="form-control" placeholder="Email do fã">
            <button class="btn btn-info" onclick="getByEmail()">Buscar</button>
        </div>
        <pre id="outputEmail"></pre>
    </div>

    <!-- CRIAÇÃO -->
    <div class="section">
        <h3>Criar Fã</h3>
        <form id="formCreate" onsubmit="createFa(event)">
            <div class="row mb-2">
                <div class="col"><input type="email" id="emailPost" class="form-control" placeholder="Email" required></div>
                <div class="col"><input type="text" id="nomePost" class="form-control" placeholder="Nome" required></div>
            </div>
            <div class="row mb-2">
                <div class="col"><input type="text" id="generoPost" class="form-control" placeholder="Gênero"></div>
                <div class="col"><input type="number" id="idadePost" class="form-control" placeholder="Idade"></div>
            </div>
            <div class="row mb-2">
                <div class="col"><input type="text" id="univPost" class="form-control" placeholder="Universo Favorito"></div>
                <div class="col"><input type="number" id="tempoPost" class="form-control" placeholder="Tempo Geek"></div>
            </div>
            <div class="row mb-2">
                <div class="col"><input type="text" id="ocupacaoPost" class="form-control" placeholder="Ocupação"></div>
                <div class="col"><button class="btn btn-success w-100" type="submit">Criar</button></div>
            </div>
        </form>
        <pre id="outputPost"></pre>
    </div>

    <!-- ATUALIZAÇÃO -->
    <div class="section">
        <h3>Atualizar Fã</h3>
        <form id="formUpdate" onsubmit="updateFa(event)">
            <div class="row mb-2">
                <div class="col"><input type="email" id="emailPut" class="form-control" placeholder="Email do fã" required></div>
                <div class="col"><input type="text" id="nomePut" class="form-control" placeholder="Nome"></div>
            </div>
            <div class="row mb-2">
                <div class="col"><input type="text" id="generoPut" class="form-control" placeholder="Gênero"></div>
                <div class="col"><input type="number" id="idadePut" class="form-control" placeholder="Idade"></div>
            </div>
            <div class="row mb-2">
                <div class="col"><input type="text" id="univPut" class="form-control" placeholder="Universo Favorito"></div>
                <div class="col"><input type="number" id="tempoPut" class="form-control" placeholder="Tempo Geek"></div>
            </div>
            <div class="row mb-2">
                <div class="col"><input type="text" id="ocupacaoPut" class="form-control" placeholder="Ocupação"></div>
                <div class="col"><button class="btn btn-warning w-100" type="submit">Atualizar</button></div>
            </div>
        </form>
        <pre id="outputPut"></pre>
    </div>

    <!-- DELEÇÃO -->
    <div class="section">
        <h3>Deletar Fã</h3>
        <div class="input-group mb-2">
            <input type="email" id="emailDel" class="form-control" placeholder="Email do fã">
            <button class="btn btn-danger" onclick="deleteFa()">Deletar</button>
        </div>
        <pre id="outputDel"></pre>
    </div>
</div>

<script>
    const baseUrl = 'http://localhost:8080/fa';

    // GET ALL
    async function getAll() {
        const res = await fetch(baseUrl);
        const data = await res.json();
        const tbody = document.querySelector("#faTable tbody");
        tbody.innerHTML = "";
        data.forEach(fa => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>${fa.email}</td>
                <td>${fa.nome}</td>
                <td>${fa.genero || ''}</td>
                <td>${fa.idade || ''}</td>
                <td>${fa.univ_fav || ''}</td>
                <td>${fa.tempo_geek != null ? fa.tempo_geek + ' anos' : ''}</td>
                <td>${fa.ocupacao || ''}</td>
            `;
            tbody.appendChild(tr);
        });
    }

    // GET by email
    async function getByEmail() {
        const email = document.getElementById('emailGet').value;
        const res = await fetch(`${baseUrl}/${email}`);
        const output = document.getElementById('outputEmail');
        if (res.status === 404) {
            output.textContent = "Fã não encontrado";
            return;
        }
        const data = await res.json();
        output.textContent = JSON.stringify(data, null, 2);
    }

    // POST
    async function createFa(event) {
        event.preventDefault();
        const fa = {
            email: document.getElementById('emailPost').value,
            nome: document.getElementById('nomePost').value,
            genero: document.getElementById('generoPost').value,
            idade: parseInt(document.getElementById('idadePost').value),
            univ_fav: document.getElementById('univPost').value,
            tempo_geek: parseInt(document.getElementById('tempoPost').value),
            ocupacao: document.getElementById('ocupacaoPost').value
        };
        const res = await fetch(baseUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(fa)
        });
        document.getElementById('outputPost').textContent = await res.text();
        getAll();
    }

    // PUT
    async function updateFa(event) {
        event.preventDefault();
        const email = document.getElementById('emailPut').value;
        const fa = {
            nome: document.getElementById('nomePut').value,
            genero: document.getElementById('generoPut').value,
            idade: parseInt(document.getElementById('idadePut').value),
            univ_fav: document.getElementById('univPut').value,
            tempo_geek: parseInt(document.getElementById('tempoPut').value),
            ocupacao: document.getElementById('ocupacaoPut').value
        };
        const res = await fetch(`${baseUrl}/${email}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(fa)
        });
        document.getElementById('outputPut').textContent = await res.text();
        getAll();
    }

    // DELETE
    async function deleteFa() {
        const email = document.getElementById('emailDel').value;
        const res = await fetch(`${baseUrl}/${email}`, { method: 'DELETE' });
        document.getElementById('outputDel').textContent = await res.text() || "Fã deletado";
        getAll();
    }

    // Inicializa tabela
    getAll();
</script>
</body>
</html>
